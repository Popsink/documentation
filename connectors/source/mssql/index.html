
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The MSSQL Source Connector is a powerful and efficient solution designed to facilitate seamless data integration between your Microsoft SQL Server (MSSQL) databases and Popsink. This connector helps you synchronize with Microsoft SQL Server in real-time, ensuring that your target systems remain updated with the latest information in real-time, driving business intelligence, analytics, and operational efficiency.">
      
      
      
        <link rel="canonical" href="https://docs.popsink.com/connectors/source/mssql/">
      
      
        <link rel="prev" href="../mongodb/">
      
      
        <link rel="next" href="../mysql/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>MSSQL Source - Popsink documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mssql-source" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Popsink documentation" class="md-header__button md-logo" aria-label="Popsink documentation" data-md-component="logo">
      
  <img src="../../../assets/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Popsink documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MSSQL Source
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Popsink documentation" class="md-nav__button md-logo" aria-label="Popsink documentation" data-md-component="logo">
      
  <img src="../../../assets/logo.svg" alt="logo">

    </a>
    Popsink documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome to Popsink Documentation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../alerting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Popsink Alerting with Source and Target Connectors
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Popsink Deployment Options
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../roadmap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Popsink Roadmap
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../source/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Source Connectors
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../target/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Target Connectors
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Changelog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../changelog/v1.78/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    v1.78 08/02/2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../changelog/v1.83/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    v1.83 18/03/2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../changelog/v1.84/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    v1.84 03/04/2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../changelog/v3.2302/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    v3.2302 01/10/2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../changelog/v3.24/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    v3.24 14/10/2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../changelog/v3.29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    v3.29 13/11/2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../changelog/v3.7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    v3.7 29/01/2025
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../changelog/v3.8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    v3.8 25/03/2025
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Connectors
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Connectors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1" checked>
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Source
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            Source
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../application/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Application Source
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../attio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Attio Source
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bigquery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BigQuery Source
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../datagen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Datagen Source
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../eventhub/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Eventhub Source
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../firestore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Firestore Source
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hubspot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HubSpot Source
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ibmi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IBMi (AS/400) Source
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kafka Source
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mongodb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MongoDB Source
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    MSSQL Source
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    MSSQL Source
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Table of Contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-features" class="md-nav__link">
    <span class="md-ellipsis">
      Key Features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security" class="md-nav__link">
    <span class="md-ellipsis">
      Security
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#relevant-roles" class="md-nav__link">
    <span class="md-ellipsis">
      Relevant Roles
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-dedicated-role" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a Dedicated Role
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Creating a Dedicated Role">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#steps" class="md-nav__link">
    <span class="md-ellipsis">
      Steps
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enabling-cdc" class="md-nav__link">
    <span class="md-ellipsis">
      Enabling CDC
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Enabling CDC">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-databases" class="md-nav__link">
    <span class="md-ellipsis">
      For Databases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-tables" class="md-nav__link">
    <span class="md-ellipsis">
      For Tables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-all" class="md-nav__link">
    <span class="md-ellipsis">
      For All
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housekeeping-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      Housekeeping Scripts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Housekeeping Scripts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purging-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Purging Logs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-if-cdc-is-enabled" class="md-nav__link">
    <span class="md-ellipsis">
      Check if CDC is Enabled
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-cdc" class="md-nav__link">
    <span class="md-ellipsis">
      Disable CDC
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mysql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MySQL Source
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../oracle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Oracle Source
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../postgres/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Postgres Source
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../salesforce/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Salesforce Source
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../snowflake/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Snowflake source
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../webhook/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Webhook Source
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" >
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Target
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            Target
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../target/airtable/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Airtable Target
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../target/application/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Application Target
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../target/bigquery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BigQuery Target
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../target/clickhouse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ClickHouse Target
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../target/cosmosdb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CosmosDB Target
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../target/deltalake/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DeltaLake Target
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../target/hubspot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hubspot Target
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../target/hudi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hudi Target
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../target/ibmi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IBMi (AS/400) Target
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../target/iceberg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Iceberg Target
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../target/mongodb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MongoDB Target
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../target/mssql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MSSQL Target
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../target/mysql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MySQL Target
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../target/oracle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Oracle Target
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../target/pinecone/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pinecone Target
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../target/postgres/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Postgres Target
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../target/pubsub/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pubsub Target
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../target/slack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Slack Target
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../target/snowflake/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Snowflake Target
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../target/teradata/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Teradata Target
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../target/webhook/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Webhook Target
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    On prem
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            On prem
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../on-prem/api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Api
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../on-prem/on-prem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Popsink API Documentation - Easy Step-by-Step Guide
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Snowflake ibmi
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Snowflake ibmi
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../snowflake-ibmi/db2_setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Setup a IBMi system
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../snowflake-ibmi/journaling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DB2 Journaling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../snowflake-ibmi/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Table of Contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-features" class="md-nav__link">
    <span class="md-ellipsis">
      Key Features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security" class="md-nav__link">
    <span class="md-ellipsis">
      Security
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#relevant-roles" class="md-nav__link">
    <span class="md-ellipsis">
      Relevant Roles
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-dedicated-role" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a Dedicated Role
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Creating a Dedicated Role">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#steps" class="md-nav__link">
    <span class="md-ellipsis">
      Steps
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enabling-cdc" class="md-nav__link">
    <span class="md-ellipsis">
      Enabling CDC
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Enabling CDC">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-databases" class="md-nav__link">
    <span class="md-ellipsis">
      For Databases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-tables" class="md-nav__link">
    <span class="md-ellipsis">
      For Tables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-all" class="md-nav__link">
    <span class="md-ellipsis">
      For All
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#housekeeping-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      Housekeeping Scripts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Housekeeping Scripts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purging-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Purging Logs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-if-cdc-is-enabled" class="md-nav__link">
    <span class="md-ellipsis">
      Check if CDC is Enabled
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-cdc" class="md-nav__link">
    <span class="md-ellipsis">
      Disable CDC
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="mssql-source">MSSQL Source</h1>
<p>The MSSQL Source Connector is a powerful and efficient solution designed to facilitate seamless data integration between your Microsoft SQL Server (MSSQL) databases and Popsink. This connector helps you synchronize with Microsoft SQL Server in real-time, ensuring that your target systems remain updated with the latest information in real-time, driving business intelligence, analytics, and operational efficiency.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#key-features">Key Features</a></li>
<li><a href="#security">Security</a></li>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#creating-a-dedicated-role">Creating a Dedicated Role</a></li>
<li><a href="#enabling-cdc">Enabling CDC</a></li>
<li><a href="#housekeeping-scripts">Housekeeping Scripts</a></li>
</ol>
<h2 id="key-features">Key Features</h2>
<ul>
<li><strong>Real-time Change Data Capture (CDC):</strong> the MSSQL Source Connector employs a CDC mechanism using the native Microsoft SQL Server logical decoding feature, capturing and streaming changes (inserts, updates, and deletes) as they occur in your database.</li>
<li><strong>Fault-tolerant and Scalable:</strong> The MSSQL Source Connector is built with fault tolerance and scalability in mind. It is capable of resuming data replication from the last known offset in case of failures, ensuring data consistency and minimal downtime.</li>
<li><strong>Initial Load:</strong> The connector automatically performs an initial full table load.</li>
<li><strong>Advanced Filtering:</strong> The MSSQL Source Connector provides a range of filtering options, including table and schema filters, allowing you to selectively replicate specific tables and schemas based on your needs.</li>
</ul>
<h2 id="security">Security</h2>
<p>The connector supports SSL/TLS encryption for secure communication between the connector and your Microsoft SQL Server database.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>You will need to have Change Data Capture enabled on the tables you want to ingest. <a href="#enabling-cdc">See Enabling CDC</a></li>
<li>You will need a user with the necessary permissions. <a href="#creating-a-dedicated-role">See Creating a Dedicated Role</a></li>
</ul>
<h3 id="relevant-roles">Relevant Roles</h3>
<ul>
<li><strong>sysadmin:</strong> role required for enabling CDC at the database level.</li>
<li><strong>db_owner:</strong> role required for enabling CDC at the table level.</li>
</ul>
<h2 id="creating-a-dedicated-role">Creating a Dedicated Role</h2>
<p>This step creates a dedicated replication ROLE, assigns it to your USER and grants it the necessary permissions to work with </p>
<h3 id="steps">Steps</h3>
<ol>
<li><strong>Create the Replication Role:</strong>
    <div class="highlight"><pre><span></span><code><span class="n">USE</span><span class="w"> </span><span class="p">[</span><span class="err">{{</span><span class="n">your_database</span><span class="err">}}</span><span class="p">];</span>
<span class="k">GO</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">cdc_role</span><span class="p">;</span>
<span class="k">GO</span>
</code></pre></div></li>
<li><strong>Assign the Replication Role to a User:</strong>
    <div class="highlight"><pre><span></span><code><span class="n">USE</span><span class="w"> </span><span class="p">[</span><span class="err">{{</span><span class="n">your_database</span><span class="err">}}</span><span class="p">];</span>
<span class="k">GO</span>
<span class="k">EXEC</span><span class="w"> </span><span class="n">sp_addrolemember</span><span class="w"> </span><span class="s1">&#39;cdc_role&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{{your_user}}&#39;</span><span class="p">;</span>
<span class="k">GO</span>
</code></pre></div></li>
<li><strong>Grant CDC Permissions:</strong>
    <div class="highlight"><pre><span></span><code><span class="n">USE</span><span class="w"> </span><span class="p">[</span><span class="err">{{</span><span class="n">your_database</span><span class="err">}}</span><span class="p">];</span>
<span class="k">GO</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">EXECUTE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">SCHEMA</span><span class="p">::</span><span class="n">cdc</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">cdc_role</span><span class="p">;</span>
<span class="k">GO</span>
</code></pre></div></li>
<li><strong>Grant Permissions to Check Version, Encryption, and Track Schema:</strong>
    <div class="highlight"><pre><span></span><code><span class="n">USE</span><span class="w"> </span><span class="n">master</span><span class="p">;</span>
<span class="k">GO</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">SERVER</span><span class="w"> </span><span class="k">STATE</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">cdc_role</span><span class="p">;</span>
<span class="k">GO</span>

<span class="n">USE</span><span class="w"> </span><span class="err">{{</span><span class="n">your_database</span><span class="err">}}</span><span class="p">;</span>
<span class="k">GO</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">OBJECT</span><span class="p">::</span><span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">TABLES</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">cdc_role</span><span class="p">;</span>
<span class="k">GO</span>
</code></pre></div></li>
</ol>
<h2 id="enabling-cdc">Enabling CDC</h2>
<p>To enable CDC for your data, you need to do two things: 1) Enable CDC at the Database level, and 2) Enable CDC at the Table level. </p>
<h3 id="for-databases">For Databases</h3>
<ol>
<li>
<p><strong>Enable CDC on a Database:</strong>
    <div class="highlight"><pre><span></span><code><span class="n">USE</span><span class="w"> </span><span class="p">[</span><span class="err">{{</span><span class="n">your_database</span><span class="err">}}</span><span class="p">];</span>
<span class="k">GO</span>
<span class="k">EXEC</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">sp_cdc_enable_db</span><span class="p">;</span>
<span class="k">GO</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Enable CDC on Multiple Databases:</strong>
    <div class="highlight"><pre><span></span><code><span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">databases</span><span class="w"> </span><span class="k">CURSOR</span><span class="p">;</span>
<span class="k">SET</span><span class="w"> </span><span class="o">@</span><span class="n">databases</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CURSOR</span><span class="w"> </span><span class="k">FOR</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">databases</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="err">{{</span><span class="n">your_database_list</span><span class="err">}}</span><span class="p">);</span>

<span class="k">OPEN</span><span class="w"> </span><span class="o">@</span><span class="n">databases</span><span class="p">;</span>

<span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">dbName</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>

<span class="k">FETCH</span><span class="w"> </span><span class="k">NEXT</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">@</span><span class="n">databases</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">@</span><span class="n">dbName</span><span class="p">;</span>

<span class="n">WHILE</span><span class="w"> </span><span class="o">@@</span><span class="n">FETCH_STATUS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="k">BEGIN</span>
<span class="w">    </span><span class="k">EXEC</span><span class="p">(</span><span class="s1">&#39;USE &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">@</span><span class="n">dbName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;; EXEC sys.sp_cdc_enable_db;&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">FETCH</span><span class="w"> </span><span class="k">NEXT</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">@</span><span class="n">databases</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">@</span><span class="n">dbName</span><span class="p">;</span>
<span class="k">END</span><span class="p">;</span>

<span class="k">CLOSE</span><span class="w"> </span><span class="o">@</span><span class="n">databases</span><span class="p">;</span>
<span class="k">DEALLOCATE</span><span class="w"> </span><span class="o">@</span><span class="n">databases</span><span class="p">;</span>
</code></pre></div></p>
</li>
</ol>
<h3 id="for-tables">For Tables</h3>
<ol>
<li>
<p><strong>Enable CDC on a Table:</strong>
    <div class="highlight"><pre><span></span><code><span class="n">USE</span><span class="w"> </span><span class="p">[</span><span class="err">{{</span><span class="n">your_database</span><span class="err">}}</span><span class="p">];</span>
<span class="k">GO</span>
<span class="k">EXEC</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">sp_cdc_enable_table</span>
<span class="w">    </span><span class="o">@</span><span class="n">source_schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="s1">&#39;dbo&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="o">@</span><span class="n">source_name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="s1">&#39;{{your_table}}&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="o">@</span><span class="n">role_name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="s1">&#39;cdc_role&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">-- use @role_name = NULL if you haven&#39;t set up a role</span>
<span class="w">    </span><span class="o">@</span><span class="n">supports_net_changes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">GO</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Enable CDC on multiple Tables:</strong>
    <div class="highlight"><pre><span></span><code><span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">tables</span><span class="w"> </span><span class="k">CURSOR</span><span class="p">;</span>
<span class="k">SET</span><span class="w"> </span><span class="o">@</span><span class="n">tables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CURSOR</span><span class="w"> </span><span class="k">FOR</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">schema_name</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">schema_id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">schema_name</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">table_name</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">tables</span><span class="w"> </span><span class="n">t</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="err">{{</span><span class="n">your_table_list</span><span class="err">}}</span><span class="p">);</span>

<span class="k">OPEN</span><span class="w"> </span><span class="o">@</span><span class="n">tables</span><span class="p">;</span>

<span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">schemaName</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">tableName</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>

<span class="k">FETCH</span><span class="w"> </span><span class="k">NEXT</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">@</span><span class="n">tables</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">@</span><span class="n">schemaName</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">tableName</span><span class="p">;</span>

<span class="n">WHILE</span><span class="w"> </span><span class="o">@@</span><span class="n">FETCH_STATUS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="k">BEGIN</span>
<span class="w">    </span><span class="k">EXEC</span><span class="p">(</span><span class="s1">&#39;USE {{your_database}}; EXEC sys.sp_cdc_enable_table @source_schema = &#39;&#39;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">@</span><span class="n">schemaName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&#39;&#39;, @source_name = &#39;&#39;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">@</span><span class="n">tableName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&#39;&#39;, @role_name = &#39;&#39;cdc_user&#39;&#39; + @supports_net_changes = 1;&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">FETCH</span><span class="w"> </span><span class="k">NEXT</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">@</span><span class="n">tables</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">@</span><span class="n">schemaName</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">tableName</span><span class="p">;</span>
<span class="k">END</span><span class="p">;</span>

<span class="k">CLOSE</span><span class="w"> </span><span class="o">@</span><span class="n">tables</span><span class="p">;</span>
<span class="k">DEALLOCATE</span><span class="w"> </span><span class="o">@</span><span class="n">tables</span><span class="p">;</span>
</code></pre></div></p>
</li>
</ol>
<h3 id="for-all">For All</h3>
<ol>
<li><strong>Enable CDC on multiple Tables in multiple Databases:</strong>
    <div class="highlight"><pre><span></span><code><span class="c1">-- Enable CDC on all databases&#39;</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">dbName</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">128</span><span class="p">);</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">tableName</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">128</span><span class="p">);</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="k">sql</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">(</span><span class="k">MAX</span><span class="p">);</span>

<span class="c1">-- Cursor for all databases</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="n">db_cursor</span><span class="w"> </span><span class="k">CURSOR</span><span class="w"> </span><span class="k">FOR</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">name</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">databases</span>
<span class="c1">-- [Optional] WHERE name LIKE &#39;something-%&#39;;</span>

<span class="c1">-- Open the cursor and fetch the first database</span>
<span class="k">OPEN</span><span class="w"> </span><span class="n">db_cursor</span><span class="p">;</span>
<span class="k">FETCH</span><span class="w"> </span><span class="k">NEXT</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">db_cursor</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">@</span><span class="n">dbName</span><span class="p">;</span>

<span class="c1">-- Loop through all databases</span>
<span class="n">WHILE</span><span class="w"> </span><span class="o">@@</span><span class="n">FETCH_STATUS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="k">BEGIN</span>
<span class="w">    </span><span class="c1">-- Enable CDC on the database if not already enabled</span>
<span class="w">    </span><span class="k">SET</span><span class="w"> </span><span class="o">@</span><span class="k">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;IF NOT EXISTS (SELECT 1 FROM sys.databases WHERE name = &#39;&#39;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">@</span><span class="n">dbName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&#39;&#39; AND is_cdc_enabled = 1)</span>
<span class="s1">                BEGIN</span>
<span class="s1">                    EXEC(&#39;&#39;USE [&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">@</span><span class="n">dbName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;]; EXEC sys.sp_cdc_enable_db&#39;&#39;)</span>
<span class="s1">                END&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="k">EXEC</span><span class="w"> </span><span class="n">sp_executesql</span><span class="w"> </span><span class="o">@</span><span class="k">sql</span><span class="p">;</span>

<span class="w">    </span><span class="c1">-- Cursor for all tables in the current database</span>
<span class="w">    </span><span class="k">DECLARE</span><span class="w"> </span><span class="n">table_cursor</span><span class="w"> </span><span class="k">CURSOR</span><span class="w"> </span><span class="k">FOR</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">QUOTENAME</span><span class="p">(</span><span class="k">SCHEMA_NAME</span><span class="p">(</span><span class="n">schema_id</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">QUOTENAME</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">tables</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">is_tracked_by_cdc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">-- Only select tables not already tracked by CDC, you may add more conditions</span>

<span class="w">    </span><span class="c1">-- Open the cursor for tables</span>
<span class="w">    </span><span class="k">SET</span><span class="w"> </span><span class="o">@</span><span class="k">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USE [&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">@</span><span class="n">dbName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;]&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="k">EXEC</span><span class="w"> </span><span class="n">sp_executesql</span><span class="w"> </span><span class="o">@</span><span class="k">sql</span><span class="p">;</span>

<span class="w">    </span><span class="k">OPEN</span><span class="w"> </span><span class="n">table_cursor</span><span class="p">;</span>
<span class="w">    </span><span class="k">FETCH</span><span class="w"> </span><span class="k">NEXT</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">table_cursor</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">@</span><span class="n">tableName</span><span class="p">;</span>

<span class="w">    </span><span class="c1">-- Loop through all tables</span>
<span class="w">    </span><span class="n">WHILE</span><span class="w"> </span><span class="o">@@</span><span class="n">FETCH_STATUS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="k">BEGIN</span>
<span class="w">        </span><span class="c1">-- Enable CDC on the table</span>
<span class="w">        </span><span class="k">SET</span><span class="w"> </span><span class="o">@</span><span class="k">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USE [&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">@</span><span class="n">dbName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;]; EXEC sys.sp_cdc_enable_table @source_schema = N&#39;&#39;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">SCHEMA_NAME</span><span class="p">(</span><span class="n">schema_id</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&#39;&#39;, @source_name = N&#39;&#39;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">@</span><span class="n">tableName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&#39;&#39;, @role_name = NULL, @supports_net_changes = 1&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="k">EXEC</span><span class="w"> </span><span class="n">sp_executesql</span><span class="w"> </span><span class="o">@</span><span class="k">sql</span><span class="p">;</span>

<span class="w">        </span><span class="c1">-- Fetch the next table</span>
<span class="w">        </span><span class="k">FETCH</span><span class="w"> </span><span class="k">NEXT</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">table_cursor</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">@</span><span class="n">tableName</span><span class="p">;</span>
<span class="w">    </span><span class="k">END</span><span class="p">;</span>

<span class="w">    </span><span class="c1">-- Close and deallocate the table cursor</span>
<span class="w">    </span><span class="k">CLOSE</span><span class="w"> </span><span class="n">table_cursor</span><span class="p">;</span>
<span class="w">    </span><span class="k">DEALLOCATE</span><span class="w"> </span><span class="n">table_cursor</span><span class="p">;</span>

<span class="w">    </span><span class="c1">-- Fetch the next database</span>
<span class="w">    </span><span class="k">FETCH</span><span class="w"> </span><span class="k">NEXT</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">db_cursor</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">@</span><span class="n">dbName</span><span class="p">;</span>
<span class="k">END</span><span class="p">;</span>

<span class="c1">-- Close and deallocate the database cursor</span>
<span class="k">CLOSE</span><span class="w"> </span><span class="n">db_cursor</span><span class="p">;</span>
<span class="k">DEALLOCATE</span><span class="w"> </span><span class="n">db_cursor</span><span class="p">;</span>
</code></pre></div></li>
</ol>
<h2 id="housekeeping-scripts">Housekeeping Scripts</h2>
<p>Here are a few useful scripts that can help you manage the CDC lifecycle.</p>
<h3 id="purging-logs">Purging Logs</h3>
<p>Enabling Logs can take up space on your database so it's best practice to purge them regularly. There is a tradeoff between the log retention and the operational resilience of your replication pipeline. A longer retention means you will need more time to recover from outages before having to resync. Shorter retention takes up less space but gives you less time to recover.</p>
<ol>
<li><strong>Purge CDC Logs:</strong>
    <div class="highlight"><pre><span></span><code><span class="c1">-- Set the database and the retention period</span>
<span class="n">USE</span><span class="w"> </span><span class="n">YourDatabaseName</span><span class="p">;</span>
<span class="k">GO</span>

<span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">retentionDays</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span><span class="w"> </span><span class="c1">-- Set the retention period in days</span>

<span class="c1">-- Convert retention days to a cutoff LSN</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">retentionDateTime</span><span class="w"> </span><span class="n">DATETIME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DATEADD</span><span class="p">(</span><span class="k">DAY</span><span class="p">,</span><span class="w"> </span><span class="o">-@</span><span class="n">retentionDays</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">());</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">cutoffLSN</span><span class="w"> </span><span class="nb">BINARY</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="c1">-- Retrieve the minimum LSN based on the retention date</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">@</span><span class="n">cutoffLSN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">fn_cdc_map_time_to_lsn</span><span class="p">(</span><span class="s1">&#39;smallest greater than or equal&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">retentionDateTime</span><span class="p">);</span>

<span class="c1">-- Check if the cutoff LSN is valid</span>
<span class="k">IF</span><span class="w"> </span><span class="o">@</span><span class="n">cutoffLSN</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="k">BEGIN</span>
<span class="w">    </span><span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">capture_instance</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
<span class="w">    </span><span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="k">sql</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">(</span><span class="k">MAX</span><span class="p">);</span>

<span class="w">    </span><span class="c1">-- Cursor to go through each capture instance</span>
<span class="w">    </span><span class="k">DECLARE</span><span class="w"> </span><span class="n">instance_cursor</span><span class="w"> </span><span class="k">CURSOR</span><span class="w"> </span><span class="k">FOR</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">capture_instance</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">cdc</span><span class="p">.</span><span class="n">change_tables</span><span class="p">;</span>

<span class="w">    </span><span class="k">OPEN</span><span class="w"> </span><span class="n">instance_cursor</span><span class="p">;</span>

<span class="w">    </span><span class="k">FETCH</span><span class="w"> </span><span class="k">NEXT</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">instance_cursor</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">@</span><span class="n">capture_instance</span><span class="p">;</span>

<span class="w">    </span><span class="n">WHILE</span><span class="w"> </span><span class="o">@@</span><span class="n">FETCH_STATUS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="k">BEGIN</span>
<span class="w">        </span><span class="c1">-- Generate the cleanup command for each capture instance</span>
<span class="w">        </span><span class="k">SET</span><span class="w"> </span><span class="o">@</span><span class="k">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="s1">&#39;EXEC sys.sp_cdc_cleanup_change_table @capture_instance = &#39;&#39;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">@</span><span class="n">capture_instance</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&#39;&#39;, @low_water_mark = &#39;&#39;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span><span class="w"> </span><span class="o">@</span><span class="n">cutoffLSN</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&#39;&#39;;&#39;</span><span class="p">;</span>

<span class="w">        </span><span class="c1">-- Execute the cleanup command</span>
<span class="w">        </span><span class="k">EXEC</span><span class="w"> </span><span class="n">sp_executesql</span><span class="w"> </span><span class="o">@</span><span class="k">sql</span><span class="p">;</span>

<span class="w">        </span><span class="k">FETCH</span><span class="w"> </span><span class="k">NEXT</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">instance_cursor</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">@</span><span class="n">capture_instance</span><span class="p">;</span>
<span class="w">    </span><span class="k">END</span><span class="p">;</span>

<span class="w">    </span><span class="k">CLOSE</span><span class="w"> </span><span class="n">instance_cursor</span><span class="p">;</span>
<span class="w">    </span><span class="k">DEALLOCATE</span><span class="w"> </span><span class="n">instance_cursor</span><span class="p">;</span>

<span class="w">    </span><span class="n">PRINT</span><span class="w"> </span><span class="s1">&#39;CDC logs purged successfully up to &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span><span class="w"> </span><span class="o">@</span><span class="n">retentionDateTime</span><span class="p">,</span><span class="w"> </span><span class="mi">121</span><span class="p">);</span>
<span class="k">END</span>
<span class="k">ELSE</span>
<span class="k">BEGIN</span>
<span class="w">    </span><span class="n">PRINT</span><span class="w"> </span><span class="s1">&#39;No valid LSN found for the specified retention period.&#39;</span><span class="p">;</span>
<span class="k">END</span>
<span class="k">GO</span>
</code></pre></div></li>
</ol>
<h3 id="check-if-cdc-is-enabled">Check if CDC is Enabled</h3>
<ol>
<li>
<p><strong>Check if it is Enabled on a Database:</strong>
    <div class="highlight"><pre><span></span><code><span class="n">USE</span><span class="w"> </span><span class="n">master</span>
<span class="k">GO</span>
<span class="k">select</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">is_cdc_enabled</span>
<span class="k">from</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">databases</span>
<span class="k">where</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;{{your_database}}&#39;</span>
<span class="k">GO</span>
</code></pre></div>
    0 means CDC is not enabled, 1 means it is.</p>
</li>
<li>
<p><strong>Check if it is Enabled on a Table:</strong>
    <div class="highlight"><pre><span></span><code><span class="n">USE</span><span class="w"> </span><span class="p">[</span><span class="err">{{</span><span class="n">your_database</span><span class="err">}}</span><span class="p">];</span>
<span class="k">GO</span>
<span class="k">select</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="k">type</span><span class="p">,</span><span class="n">type_desc</span><span class="p">,</span><span class="n">is_tracked_by_cdc</span>
<span class="k">from</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">tables</span>
<span class="k">where</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">‘</span><span class="o">&lt;</span><span class="k">table_name</span><span class="o">&gt;</span><span class="err">’</span>
<span class="k">GO</span>
</code></pre></div>
   0 means CDC is not enabled, 1 means it is.</p>
</li>
</ol>
<h3 id="disable-cdc">Disable CDC</h3>
<ol>
<li><strong>Disable CDC on a Database:</strong>
    <div class="highlight"><pre><span></span><code><span class="n">USE</span><span class="w"> </span><span class="p">[</span><span class="err">{{</span><span class="n">your_database</span><span class="err">}}</span><span class="p">];</span>
<span class="k">GO</span>
<span class="k">EXEC</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">sp_cdc_disable_db</span><span class="p">;</span>
<span class="k">GO</span>
</code></pre></div></li>
<li><strong>Disable CDC on a Table:</strong>
    <div class="highlight"><pre><span></span><code><span class="n">USE</span><span class="w"> </span><span class="p">[</span><span class="err">{{</span><span class="n">your_database</span><span class="err">}}</span><span class="p">];</span>
<span class="k">GO</span>
<span class="k">EXEC</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">sp_cdc_disable_table</span>
<span class="w">    </span><span class="o">@</span><span class="n">source_schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="s1">&#39;dbo&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="o">@</span><span class="n">source_name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="s1">&#39;{{your_table}}&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="o">@</span><span class="n">capture_instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="s1">&#39;dbo_{{your_table}}&#39;</span><span class="p">;</span>
<span class="k">GO</span>
</code></pre></div></li>
</ol>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["header.autohide"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../../javascripts/crisp.js"></script>
      
    
  </body>
</html>